name: 编译 Files 独立 EXE

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: 拉取源码
        uses: actions/checkout@v4
        with:
          submodules: 'recursive'  # 拉取子模块（关键：解决依赖缺失）

      - name: 安装 .NET 6.0 SDK
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: 6.0.x

      - name: 还原依赖包（指定正确的解决方案路径）
        run: dotnet restore src/Files.sln  # 核心修正：解决方案在 src 目录下

      - name: 编译 Release 版本（指定正确路径）
        run: dotnet build src/Files.sln -c Release -p:Platform=x64 --no-restore

      - name: 打包编译结果
        run: |
          $source = "./src/Files/bin/Release/net6.0-windows10.0.19041.0/win-x64"
          $zipPath = "./Files_Release_x64.zip"
          Compress-Archive -Path "$source/*" -DestinationPath $zipPath

      - name: 上传编译产物
        uses: actions/upload-artifact@v4
        with:
          name: Files_Standalone_Exe
          path: ./Files_Release_x64.zip
